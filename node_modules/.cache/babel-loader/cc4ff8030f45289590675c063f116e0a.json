{"ast":null,"code":"import Drawflow from 'drawflow';\nimport { onMounted, shallowRef, h, getCurrentInstance, render, readonly, ref } from 'vue';\nexport default {\n  name: 'drawflow',\n\n  setup() {\n    const listNodes = readonly([{\n      name: 'Get/Post',\n      color: '#49494970',\n      item: 'Node1',\n      input: 0,\n      output: 1\n    }, {\n      name: 'Script',\n      color: 'blue',\n      item: 'Node2',\n      input: 1,\n      output: 2\n    }, {\n      name: 'console.log',\n      color: '#ff9900',\n      item: 'Node3',\n      input: 1,\n      output: 0\n    }]);\n    const editor = shallowRef({});\n    const dialogVisible = ref(false);\n    const dialogData = ref({});\n    const Vue = {\n      version: 3,\n      h,\n      render\n    };\n    const internalInstance = getCurrentInstance();\n    internalInstance.appContext.app._context.config.globalProperties.$df = editor;\n\n    function exportEditor() {\n      dialogData.value = editor.value.export();\n      dialogVisible.value = true;\n    }\n\n    const drag = ev => {\n      if (ev.type === \"touchstart\") {\n        mobile_item_selec = ev.target.closest(\".drag-drawflow\").getAttribute('data-node');\n      } else {\n        ev.dataTransfer.setData(\"node\", ev.target.getAttribute('data-node'));\n      }\n    };\n\n    const drop = ev => {\n      if (ev.type === \"touchend\") {\n        var parentdrawflow = document.elementFromPoint(mobile_last_move.touches[0].clientX, mobile_last_move.touches[0].clientY).closest(\"#drawflow\");\n\n        if (parentdrawflow != null) {\n          addNodeToDrawFlow(mobile_item_selec, mobile_last_move.touches[0].clientX, mobile_last_move.touches[0].clientY);\n        }\n\n        mobile_item_selec = '';\n      } else {\n        ev.preventDefault();\n        var data = ev.dataTransfer.getData(\"node\");\n        addNodeToDrawFlow(data, ev.clientX, ev.clientY);\n      }\n    };\n\n    const allowDrop = ev => {\n      ev.preventDefault();\n    };\n\n    let mobile_item_selec = '';\n    let mobile_last_move = null;\n\n    function positionMobile(ev) {\n      mobile_last_move = ev;\n    }\n\n    function addNodeToDrawFlow(name, pos_x, pos_y) {\n      pos_x = pos_x * (editor.value.precanvas.clientWidth / (editor.value.precanvas.clientWidth * editor.value.zoom)) - editor.value.precanvas.getBoundingClientRect().x * (editor.value.precanvas.clientWidth / (editor.value.precanvas.clientWidth * editor.value.zoom));\n      pos_y = pos_y * (editor.value.precanvas.clientHeight / (editor.value.precanvas.clientHeight * editor.value.zoom)) - editor.value.precanvas.getBoundingClientRect().y * (editor.value.precanvas.clientHeight / (editor.value.precanvas.clientHeight * editor.value.zoom));\n      const nodeSelected = listNodes.find(ele => ele.item == name);\n      editor.value.addNode(name, nodeSelected.input, nodeSelected.output, pos_x, pos_y, name, {}, name, 'vue');\n    }\n\n    onMounted(() => {\n      var elements = document.getElementsByClassName('drag-drawflow');\n\n      for (var i = 0; i < elements.length; i++) {\n        elements[i].addEventListener('touchend', drop, false);\n        elements[i].addEventListener('touchmove', positionMobile, false);\n        elements[i].addEventListener('touchstart', drag, false);\n      }\n\n      const id = document.getElementById(\"drawflow\");\n      editor.value = new Drawflow(id, Vue, internalInstance.appContext.app._context);\n      editor.value.start();\n      editor.value.registerNode('Node1', Node1, {}, {});\n      editor.value.registerNode('Node2', Node2, {}, {});\n      editor.value.registerNode('Node3', Node3, {}, {});\n      editor.value.import({\n        \"drawflow\": {\n          \"Home\": {\n            \"data\": {\n              \"5\": {\n                \"id\": 5,\n                \"name\": \"Node2\",\n                \"data\": {\n                  \"script\": \"(req,res) => {\\n console.log(req);\\n}\"\n                },\n                \"class\": \"Node2\",\n                \"html\": \"Node2\",\n                \"typenode\": \"vue\",\n                \"inputs\": {\n                  \"input_1\": {\n                    \"connections\": [{\n                      \"node\": \"6\",\n                      \"input\": \"output_1\"\n                    }]\n                  }\n                },\n                \"outputs\": {\n                  \"output_1\": {\n                    \"connections\": []\n                  },\n                  \"output_2\": {\n                    \"connections\": []\n                  }\n                },\n                \"pos_x\": 1000,\n                \"pos_y\": 117\n              },\n              \"6\": {\n                \"id\": 6,\n                \"name\": \"Node1\",\n                \"data\": {\n                  \"url\": \"localhost/add\",\n                  \"method\": \"post\"\n                },\n                \"class\": \"Node1\",\n                \"html\": \"Node1\",\n                \"typenode\": \"vue\",\n                \"inputs\": {},\n                \"outputs\": {\n                  \"output_1\": {\n                    \"connections\": [{\n                      \"node\": \"5\",\n                      \"output\": \"input_1\"\n                    }]\n                  }\n                },\n                \"pos_x\": 137,\n                \"pos_y\": 89\n              }\n            }\n          }\n        }\n      });\n    });\n    return {\n      exportEditor,\n      listNodes,\n      drag,\n      drop,\n      allowDrop,\n      dialogVisible,\n      dialogData\n    };\n  }\n\n};","map":{"version":3,"mappings":"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","names":["Drawflow","onMounted","shallowRef","h","getCurrentInstance","render","readonly","ref","name","setup","listNodes","color","item","input","output","editor","dialogVisible","dialogData","Vue","version","internalInstance","appContext","app","_context","config","globalProperties","$df","exportEditor","value","export","drag","ev","type","mobile_item_selec","target","closest","getAttribute","dataTransfer","setData","drop","parentdrawflow","document","elementFromPoint","mobile_last_move","touches","clientX","clientY","addNodeToDrawFlow","preventDefault","data","getData","allowDrop","positionMobile","pos_x","pos_y","precanvas","clientWidth","zoom","getBoundingClientRect","x","clientHeight","y","nodeSelected","find","ele","addNode","elements","getElementsByClassName","i","length","addEventListener","id","getElementById","start","registerNode","Node1","Node2","Node3","import"],"sourceRoot":"","sources":["/Users/juancamiloespinosa/Desktop/Juan Camilo/platzi/TR/drawflow-test/src/components/Home.vue"],"sourcesContent":["<template>\n    <p>Hello World</p>\n</template>\n\n<script>\nimport Drawflow from 'drawflow'\nimport { onMounted, shallowRef, h, getCurrentInstance, render, readonly, ref } from 'vue'\n\nexport default {\n  name: 'drawflow',\n  setup() {\n   const listNodes = readonly([\n        {\n            name: 'Get/Post',\n            color: '#49494970',\n            item: 'Node1',\n            input:0,\n            output:1\n        },\n        {\n            name: 'Script',\n            color: 'blue',\n            item: 'Node2',\n            input:1,\n            output:2\n        },\n         {\n            name: 'console.log',\n            color: '#ff9900',\n            item: 'Node3',\n            input:1,\n            output:0\n        },\n    ])\n   \n   const editor = shallowRef({})\n   const dialogVisible = ref(false)\n   const dialogData = ref({})\n   const Vue = { version: 3, h, render };\n   const internalInstance = getCurrentInstance()\n   internalInstance.appContext.app._context.config.globalProperties.$df = editor;\n   \n    function exportEditor() {\n      dialogData.value = editor.value.export();\n      dialogVisible.value = true;\n    }\n    const drag = (ev) => {\n      if (ev.type === \"touchstart\") {\n        mobile_item_selec = ev.target.closest(\".drag-drawflow\").getAttribute('data-node');\n      } else {\n      ev.dataTransfer.setData(\"node\", ev.target.getAttribute('data-node'));\n      }\n    }\n    const drop = (ev) => {\n      if (ev.type === \"touchend\") {\n        var parentdrawflow = document.elementFromPoint( mobile_last_move.touches[0].clientX, mobile_last_move.touches[0].clientY).closest(\"#drawflow\");\n        if(parentdrawflow != null) {\n          addNodeToDrawFlow(mobile_item_selec, mobile_last_move.touches[0].clientX, mobile_last_move.touches[0].clientY);\n        }\n        mobile_item_selec = '';\n      } else {\n        ev.preventDefault();\n        var data = ev.dataTransfer.getData(\"node\");\n        addNodeToDrawFlow(data, ev.clientX, ev.clientY);\n      }\n    }\n    const allowDrop = (ev) => {\n      ev.preventDefault();\n    }\n   let mobile_item_selec = '';\n   let mobile_last_move = null;\n   function positionMobile(ev) {\n     mobile_last_move = ev;\n   }\n    function addNodeToDrawFlow(name, pos_x, pos_y) {\n      pos_x = pos_x * ( editor.value.precanvas.clientWidth / (editor.value.precanvas.clientWidth * editor.value.zoom)) - (editor.value.precanvas.getBoundingClientRect().x * ( editor.value.precanvas.clientWidth / (editor.value.precanvas.clientWidth * editor.value.zoom)));\n      pos_y = pos_y * ( editor.value.precanvas.clientHeight / (editor.value.precanvas.clientHeight * editor.value.zoom)) - (editor.value.precanvas.getBoundingClientRect().y * ( editor.value.precanvas.clientHeight / (editor.value.precanvas.clientHeight * editor.value.zoom)));\n    \n      const nodeSelected = listNodes.find(ele => ele.item == name);\n      editor.value.addNode(name, nodeSelected.input,  nodeSelected.output, pos_x, pos_y, name, {}, name, 'vue');\n      \n    }\n   onMounted(() => {\n      var elements = document.getElementsByClassName('drag-drawflow');\n      for (var i = 0; i < elements.length; i++) {\n        elements[i].addEventListener('touchend', drop, false);\n        elements[i].addEventListener('touchmove', positionMobile, false);\n        elements[i].addEventListener('touchstart', drag, false );\n      }\n        \n       const id = document.getElementById(\"drawflow\");\n       editor.value = new Drawflow(id, Vue, internalInstance.appContext.app._context);\n       editor.value.start();\n       \n       editor.value.registerNode('Node1', Node1, {}, {});\n       editor.value.registerNode('Node2', Node2, {}, {});\n       editor.value.registerNode('Node3', Node3, {}, {});\n       editor.value.import({\"drawflow\":{\"Home\":{\"data\":{\"5\":{\"id\":5,\"name\":\"Node2\",\"data\":{\"script\":\"(req,res) => {\\n console.log(req);\\n}\"},\"class\":\"Node2\",\"html\":\"Node2\",\"typenode\":\"vue\",\"inputs\":{\"input_1\":{\"connections\":[{\"node\":\"6\",\"input\":\"output_1\"}]}},\"outputs\":{\"output_1\":{\"connections\":[]},\"output_2\":{\"connections\":[]}},\"pos_x\":1000,\"pos_y\":117},\"6\":{\"id\":6,\"name\":\"Node1\",\"data\":{\"url\":\"localhost/add\", \"method\": \"post\"},\"class\":\"Node1\",\"html\":\"Node1\",\"typenode\":\"vue\",\"inputs\":{},\"outputs\":{\"output_1\":{\"connections\":[{\"node\":\"5\",\"output\":\"input_1\"}]}},\"pos_x\":137,\"pos_y\":89}}}}})\n  })\n  return {\n    exportEditor, listNodes, drag, drop, allowDrop, dialogVisible, dialogData\n  }\n  }\n}\n</script>"]},"metadata":{},"sourceType":"module"}